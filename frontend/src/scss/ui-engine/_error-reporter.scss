// ============================================
// SIXORBIT UI ENGINE - ERROR REPORTER STYLES
// Centralized error display component
// ============================================

@use "../abstracts" as *;
@use "sass:color";

// Variables
$error-reporter-bg: #fff;
$error-reporter-border: #dc3545;
$error-reporter-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
$error-reporter-radius: 8px;
$error-reporter-z-index: 1050;

// Main container - fixed position, no width/height transitions
.#{$so-prefix}error-reporter {
  position: fixed;
  z-index: $error-reporter-z-index;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s ease;

  &.#{$so-prefix}show {
    opacity: 1;
    pointer-events: auto;
  }

  // Position classes - 4 corners only
  &-top-right {
    top: 20px;
    right: 20px;
  }

  &-top-left {
    top: 20px;
    left: 20px;
  }

  &-bottom-right {
    bottom: 20px;
    right: 20px;
  }

  &-bottom-left {
    bottom: 20px;
    left: 20px;
  }
}

// Badge (collapsed state and mobile)
.#{$so-prefix}error-reporter-badge {
  &-btn {
    position: relative;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    background: var(--so-danger, $error-reporter-border);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    transition:
      transform 0.2s ease,
      box-shadow 0.2s ease;

    &:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    &:active {
      transform: scale(0.98);
    }

    .material-icons {
      font-size: 24px;
    }
  }
}

.#{$so-prefix}error-reporter-count {
  position: absolute;
  top: -4px;
  right: -4px;
  min-width: 20px;
  height: 20px;
  background: white;
  color: var(--so-danger, $error-reporter-border);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 600;
  padding: 0 6px;
  border: 2px solid var(--so-danger, $error-reporter-border);
}

// Content (expanded state)
.#{$so-prefix}error-reporter-content {
  max-width: 400px;
  width: 400px;
  background: $error-reporter-bg;
  border: 1px solid $error-reporter-border;
  border-radius: $error-reporter-radius;
  box-shadow: $error-reporter-shadow;
  overflow: visible; // Changed from hidden to allow dropdown overflow
  display: flex;
  flex-direction: column;
  transition:
    width 0.3s ease,
    max-width 0.3s ease;
}

// Size variants
.#{$so-prefix}error-reporter-sm {
  .#{$so-prefix}error-reporter-content {
    max-width: 340px;
    width: 340px;
  }

  .#{$so-prefix}error-reporter-header {
    padding: 10px 14px;
    gap: 6px;
  }

  .#{$so-prefix}error-reporter-title {
    font-size: 13px;
  }

  .#{$so-prefix}error-reporter-item {
    padding: 6px 10px 6px 14px;
    font-size: 12px;
  }

  .#{$so-prefix}error-field {
    font-size: 10px;
  }

  .#{$so-prefix}error-message {
    font-size: 12px;
  }
}

.#{$so-prefix}error-reporter-xs {
  .#{$so-prefix}error-reporter-content {
    max-width: 280px;
    width: 280px;
  }

  .#{$so-prefix}error-reporter-header {
    padding: 8px 12px;
    gap: 4px;
  }

  .#{$so-prefix}error-reporter-title {
    font-size: 12px;
  }

  .#{$so-prefix}error-reporter-item {
    padding: 5px 8px 5px 14px;
    font-size: 11px;
  }

  .#{$so-prefix}error-field {
    font-size: 9px;
  }

  .#{$so-prefix}error-message {
    font-size: 11px;
  }

  .#{$so-prefix}error-reporter-count {
    width: 16px;
    height: 16px;
    min-width: 16px;
    min-height: 16px;
    font-size: 9px;
    top: -4px;
    right: -4px;
  }
}

// Header
.#{$so-prefix}error-reporter-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 16px;
  background: rgba($error-reporter-border, 0.15);
  border-bottom: 1px solid rgba($error-reporter-border, 0.2);
  overflow: visible !important;

  .material-icons {
    font-size: 20px;
  }
}

.#{$so-prefix}error-reporter-title {
  flex: 1;
  font-weight: 600;
  font-size: 14px;
  color: #333;
}

.#{$so-prefix}error-reporter-icon {
  flex-shrink: 0;
}

// Left positions: header alignment only
.#{$so-prefix}error-reporter-top-left,
.#{$so-prefix}error-reporter-bottom-left {
  .#{$so-prefix}error-reporter-header {
    justify-content: flex-end;
  }

  // Right-align title only (in header)
  .#{$so-prefix}error-reporter-title {
    text-align: right;
  }

  // Error items remain left-aligned (same as right positions)
}

// Reverse layout for bottom positions (header at bottom, errors above)
.#{$so-prefix}error-reporter-bottom-right,
.#{$so-prefix}error-reporter-bottom-left {
  .#{$so-prefix}error-reporter-content {
    flex-direction: column-reverse;
  }

  // Adjust border position for reversed layout
  .#{$so-prefix}error-reporter-header {
    border-bottom: none;
    border-top: 1px solid rgba($error-reporter-border, 0.2);
  }
}

// Position dropdown specific styles
.#{$so-prefix}error-reporter-position-dropdown {
  overflow: visible !important;
  position: relative;
  z-index: 1100; // Higher than modal to ensure dropdown is above

  // Ensure the dropdown component itself has overflow visible
  &.#{$so-prefix}dropdown {
    overflow: visible !important;
  }

  .#{$so-prefix}dropdown-trigger {
    overflow: visible !important;
  }

  .#{$so-prefix}dropdown-menu {
    overflow: visible !important;
    z-index: 1101; // Higher z-index for menu
  }

  .#{$so-prefix}dropdown-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    font-weight: normal !important;

    > span:first-child {
      flex: 1;
      font-weight: normal !important;
    }
  }

  .#{$so-prefix}dropdown-check {
    flex-shrink: 0;
    font-size: 16px;
    color: var(--so-success, #28a745);
  }

  // Dropup positioning (for bottom positions)
  &.#{$so-prefix}dropup {
    .#{$so-prefix}dropdown-menu {
      bottom: 100%;
      top: auto;
      margin-bottom: 4px;
      margin-top: 0;
    }
  }

  // Right alignment (for right positions)
  &.#{$so-prefix}dropdown-right {
    .#{$so-prefix}dropdown-menu {
      right: 0;
      left: auto;
    }
  }

  // Left alignment (for left positions)
  &.#{$so-prefix}dropdown-left {
    .#{$so-prefix}dropdown-menu {
      left: 0;
      right: auto;
    }
  }
}

// Size selector dropdown item
.#{$so-prefix}error-reporter-size-selector {
  display: flex !important;
  align-items: center;
  justify-content: flex-end;
  padding: 8px 12px !important;
  cursor: default !important; // Don't close dropdown when clicking this item
  pointer-events: none; // Make the item itself non-interactive

  &:hover {
    background: transparent !important; // Don't highlight on hover
  }

  .#{$so-prefix}btn-group {
    pointer-events: auto; // Re-enable pointer events for buttons
    display: flex;
    justify-content: flex-end;
    margin-left: auto;

    .#{$so-prefix}btn {
      min-width: 40px;
      padding: 6px 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 500;
    }
  }
}

// Position row selector
.#{$so-prefix}error-reporter-position-row {
  display: flex !important;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 8px 12px !important;
  cursor: default !important; // Don't close dropdown when clicking this item
  pointer-events: none; // Make the item itself non-interactive

  &:hover {
    background: transparent !important; // Don't highlight on hover
  }

  .#{$so-prefix}error-reporter-position-label {
    font-size: 12px;
    font-weight: 500;
    color: #666;
    text-transform: capitalize;
    min-width: 50px;
    pointer-events: none;
  }

  .#{$so-prefix}btn-group {
    pointer-events: auto; // Re-enable pointer events for buttons
    display: flex;
    gap: 0;

    .#{$so-prefix}btn {
      min-width: 50px;
      padding: 6px 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 500;
    }
  }
}

// Error list
.#{$so-prefix}error-reporter-list {
  list-style: none;
  margin: 0;
  padding: 0;
  max-height: 300px;
  overflow-y: auto;
  overflow-x: hidden; // Prevent horizontal overflow
  transition:
    max-height 0.3s ease,
    opacity 0.3s ease;
  opacity: 1;

  // Apply framework's custom scrollbar
  @include custom-scrollbar(6px, rgba($so-grey-400, 0.6), transparent);
}

// Collapsed state - hide elements except toggle button
.#{$so-prefix}error-reporter.#{$so-prefix}collapsed {
  pointer-events: none; // Allow clicks through entire container

  .#{$so-prefix}error-reporter-content {
    width: auto;
    min-width: auto;
    background: transparent;
    border-color: transparent;
    box-shadow: none;
    overflow: visible;
    pointer-events: none; // Allow clicks through transparent areas
  }

  .#{$so-prefix}error-reporter-header {
    background: transparent;
    border-color: transparent;
    overflow: visible;
    pointer-events: none; // Allow clicks through padding area
    // Keep normal padding so button stays in same position
  }

  // Hide icon, title, and position dropdown completely
  .#{$so-prefix}error-reporter-icon,
  .#{$so-prefix}error-reporter-title,
  .#{$so-prefix}error-reporter-position-dropdown {
    display: none;
  }

  // Hide error list completely
  .#{$so-prefix}error-reporter-list {
    display: none;
  }

  .#{$so-prefix}error-reporter-toggle {
    pointer-events: auto; // Keep button clickable
    overflow: visible !important;

    .material-icons {
      transform: rotate(180deg);
    }

    // Show error count badge on toggle button
    .#{$so-prefix}error-reporter-count {
      opacity: 1;
      pointer-events: auto;
      position: absolute;
      top: -6px;
      right: -6px;
    }
  }
}

// Expanded state: icon not rotated
.#{$so-prefix}error-reporter:not(.#{$so-prefix}collapsed) {
  .#{$so-prefix}error-reporter-toggle {
    .material-icons {
      transform: rotate(0deg);
    }
  }
}

// Error count badge (hidden when expanded, shown when collapsed)
.#{$so-prefix}error-reporter-count {
  position: absolute;
  width: 20px;
  height: 20px;
  min-width: 20px;
  min-height: 20px;
  background: white;
  color: var(--so-danger, $error-reporter-border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: 600;
  padding: 0;
  border: 2px solid var(--so-danger, $error-reporter-border);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 10;
  aspect-ratio: 1 / 1;
}

// Toggle button icon with smooth rotation
.#{$so-prefix}error-reporter-toggle {
  .material-icons {
    transition: transform 0.3s ease;
    display: inline-block;
  }
}

// Smooth transitions for collapsing elements
.#{$so-prefix}error-reporter-icon,
.#{$so-prefix}error-reporter-title,
.#{$so-prefix}error-reporter-position-dropdown {
  transition:
    opacity 0.3s ease,
    width 0.3s ease;
}

.#{$so-prefix}error-reporter-item {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  padding: 8px 12px 8px 16px;
  margin: 0;
  border-bottom: 1px solid #eee;
  font-size: 13px;
  cursor: pointer;
  transition: background-color 0.2s ease;
  position: relative;

  &:last-child {
    border-bottom: none;
  }

  &:hover {
    background: rgba($error-reporter-border, 0.05);
  }

  // Active state - when field is focused
  &.#{$so-prefix}active {
    background: rgba($error-reporter-border, 0.08);

    // Vertical bar before the entry
    &::before {
      content: "";
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      height: calc(100% - 12px);
      width: 3px;
      background: $error-reporter-border;
      border-radius: 2px;
    }
  }

  &.#{$so-prefix}error-reporter-more {
    cursor: default;
    background-color: #f8f9fa;
    font-style: italic;

    &:hover {
      background-color: #f8f9fa;
    }
  }
}

.#{$so-prefix}error-field {
  font-weight: 600;
  font-size: 11px;
  color: $error-reporter-border;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: block;
}

.#{$so-prefix}error-message {
  display: block;
  color: #333;
  word-break: break-word;
  font-size: 13px;
  line-height: 1.5;
}

// Nested error message list (when a field has multiple errors)
.#{$so-prefix}error-message-list {
  list-style: none;
  margin: 0;
  padding: 0;

  li {
    margin: 3px 0;
    padding: 0;
    border: none;

    &:hover {
      background: transparent;
    }
  }
}

// Modal specific styles
.#{$so-prefix}error-reporter-modal {
  // Position modal at the top of the screen
  .#{$so-prefix}modal-dialog {
    margin-top: 20px;
    margin-bottom: auto;
  }

  .#{$so-prefix}error-reporter-list {
    max-height: none;
  }

  .#{$so-prefix}modal-body {
    padding: 0;
  }

  .#{$so-prefix}error-reporter-item {
    &:first-child {
      border-top: 1px solid #eee;
    }
  }

  // Position dropdown in modal footer
  .#{$so-prefix}modal-footer {
    .#{$so-prefix}dropdown {
      width: 100%;

      .#{$so-prefix}btn {
        width: 100%;
        justify-content: space-between;

        .material-icons:last-child {
          margin-left: auto;
        }
      }
    }
  }
}

// Dark theme variant
.#{$so-prefix}error-reporter-dark {
  .#{$so-prefix}error-reporter-content {
    background: #2d2d2d;
    border-color: $error-reporter-border;
  }

  .#{$so-prefix}error-reporter-header {
    background: rgba($error-reporter-border, 0.2);
  }

  .#{$so-prefix}error-reporter-title {
    color: #fff;
  }

  .#{$so-prefix}error-reporter-item {
    border-bottom-color: #444;

    &:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    &.#{$so-prefix}error-reporter-more {
      background-color: #333;

      &:hover {
        background-color: #333;
      }
    }
  }

  .#{$so-prefix}error-message {
    color: #eee;
  }
}

// Mobile button styles
.#{$so-prefix}error-reporter-mobile-btn {
  position: relative;
  overflow: visible !important;

  .#{$so-prefix}error-reporter-count {
    opacity: 1;
    pointer-events: auto;
    position: absolute;
    top: -6px;
    right: -6px;
  }
}

// Mobile responsive
@media (max-width: 767px) {
  .#{$so-prefix}error-reporter {
    // On mobile, adjust positions
    &-mobile {
      &.#{$so-prefix}error-reporter-top-right,
      &.#{$so-prefix}error-reporter-top-left {
        top: 16px;
      }

      &.#{$so-prefix}error-reporter-bottom-right,
      &.#{$so-prefix}error-reporter-bottom-left {
        bottom: 16px;
      }

      &.#{$so-prefix}error-reporter-top-right,
      &.#{$so-prefix}error-reporter-bottom-right {
        right: 16px;
      }

      &.#{$so-prefix}error-reporter-top-left,
      &.#{$so-prefix}error-reporter-bottom-left {
        left: 16px;
      }
    }
  }

  // Make content responsive on mobile (in case it's still used)
  .#{$so-prefix}error-reporter-content {
    max-width: calc(100vw - 32px);
    width: calc(100vw - 32px);
  }
}

// Modal header dropdown styles
.#{$so-prefix}error-reporter-modal {
  // Ensure all parent containers have overflow visible
  overflow: visible !important;

  .#{$so-prefix}modal {
    overflow: visible !important;
  }

  .#{$so-prefix}modal-dialog {
    overflow: visible !important;
  }

  .#{$so-prefix}modal-content {
    overflow: visible !important;
  }

  .#{$so-prefix}modal-header {
    overflow: visible !important;

    .#{$so-prefix}modal-title {
      overflow: visible !important;
    }

    .#{$so-prefix}error-reporter-position-dropdown {
      margin-left: auto;
      overflow: visible !important;

      .#{$so-prefix}dropdown-trigger {
        overflow: visible !important;
      }

      .#{$so-prefix}dropdown-menu {
        overflow: visible !important;
      }
    }
  }

  // Modal title layout
  .#{$so-prefix}error-reporter-modal-title {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    overflow: visible !important;
  }

  .#{$so-prefix}error-reporter-modal-title-text {
    flex: 1;
    overflow: visible !important;
  }
}

// ============================================
// THEME SUPPORT - Dark Mode & System Theme
// ============================================

// Dark theme (when [data-theme="dark"] is set on document)
[data-theme="dark"] {
  .#{$so-prefix}error-reporter {
    .#{$so-prefix}error-reporter-content {
      background: #2d2d2d;
      border-color: $error-reporter-border;
    }

    .#{$so-prefix}error-reporter-header {
      background: rgba($error-reporter-border, 0.2);
      border-bottom-color: rgba($error-reporter-border, 0.3);
    }

    .#{$so-prefix}error-reporter-title {
      color: #fff;
    }

    .#{$so-prefix}error-reporter-item {
      border-bottom-color: #444;

      &:hover {
        background: rgba(255, 255, 255, 0.05);
      }

      &.#{$so-prefix}active {
        background: rgba($error-reporter-border, 0.15);
      }

      &.#{$so-prefix}error-reporter-more {
        background-color: #333;

        &:hover {
          background-color: #333;
        }
      }
    }

    .#{$so-prefix}error-message {
      color: #eee;
    }

    .#{$so-prefix}error-field {
      color: color.adjust($error-reporter-border, $lightness: 10%);
    }

    .#{$so-prefix}error-message-list li {
      color: #eee;
    }

    // Position label styling for dark mode
    .#{$so-prefix}error-reporter-position-label {
      color: #aaa;
    }

    // Toggle button styling for dark mode
    .#{$so-prefix}error-reporter-toggle {
      background: rgba($error-reporter-border, 0.9);
      border-color: rgba($error-reporter-border, 0.9);
      color: #fff;

      &:hover {
        background: $error-reporter-border;
        border-color: $error-reporter-border;
      }
    }

    // Count badge styling for dark mode
    .#{$so-prefix}error-reporter-count {
      background: #fff;
      color: $error-reporter-border;
      border: 2px solid #2d2d2d;
    }

    // Collapsed state - ensure transparent bg/border in dark mode
    &.#{$so-prefix}collapsed {
      .#{$so-prefix}error-reporter-content {
        background: transparent;
        border-color: transparent;
      }

      .#{$so-prefix}error-reporter-header {
        background: transparent;
        border-color: transparent;
      }
    }
  }

  // Bottom positions: adjust top border color for dark theme
  .#{$so-prefix}error-reporter-bottom-right,
  .#{$so-prefix}error-reporter-bottom-left {
    .#{$so-prefix}error-reporter-header {
      border-top-color: rgba($error-reporter-border, 0.3);
    }
  }
}

// System theme (respects OS preference when [data-theme="system"] is set)
[data-theme="system"] {
  @media (prefers-color-scheme: dark) {
    .#{$so-prefix}error-reporter {
      .#{$so-prefix}error-reporter-content {
        background: #2d2d2d;
        border-color: $error-reporter-border;
      }

      .#{$so-prefix}error-reporter-header {
        background: rgba($error-reporter-border, 0.2);
        border-bottom-color: rgba($error-reporter-border, 0.3);
      }

      .#{$so-prefix}error-reporter-title {
        color: #fff;
      }

      .#{$so-prefix}error-reporter-item {
        border-bottom-color: #444;

        &:hover {
          background: rgba(255, 255, 255, 0.05);
        }

        &.#{$so-prefix}active {
          background: rgba($error-reporter-border, 0.15);
        }

        &.#{$so-prefix}error-reporter-more {
          background-color: #333;

          &:hover {
            background-color: #333;
          }
        }
      }

      .#{$so-prefix}error-message {
        color: #eee;
      }

      .#{$so-prefix}error-field {
        color: color.adjust($error-reporter-border, $lightness: 10%);
      }

      .#{$so-prefix}error-message-list li {
        color: #eee;
      }

      // Position label styling for dark mode
      .#{$so-prefix}error-reporter-position-label {
        color: #aaa;
      }

      // Toggle button styling for dark mode
      .#{$so-prefix}error-reporter-toggle {
        background: rgba($error-reporter-border, 0.9);
        border-color: rgba($error-reporter-border, 0.9);
        color: #fff;

        &:hover {
          background: $error-reporter-border;
          border-color: $error-reporter-border;
        }
      }

      // Count badge styling for dark mode
      .#{$so-prefix}error-reporter-count {
        background: #fff;
        color: $error-reporter-border;
        border: 2px solid #2d2d2d;
      }

      // Collapsed state - ensure transparent bg/border in dark mode
      &.#{$so-prefix}collapsed {
        .#{$so-prefix}error-reporter-content {
          background: transparent;
          border-color: transparent;
        }

        .#{$so-prefix}error-reporter-header {
          background: transparent;
          border-color: transparent;
        }
      }
    }

    // Bottom positions: adjust top border color for dark theme
    .#{$so-prefix}error-reporter-bottom-right,
    .#{$so-prefix}error-reporter-bottom-left {
      .#{$so-prefix}error-reporter-header {
        border-top-color: rgba($error-reporter-border, 0.3);
      }
    }
  }
}
